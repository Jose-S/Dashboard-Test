"use strict";const e=require("@diez/cli-core"),o=require("child_process"),t=require("fs-extra"),i=require("path"),r=require("semver"),n={android:"https://diez.org/getting-started/kotlin.html",ios:"https://diez.org/getting-started/swift.html",web:"https://diez.org/getting-started/javascript.html"};module.exports=(async(s,a)=>{if(!["android","web","ios"].includes(a))return e.Log.error("Usage: diez start <android|ios|web>"),void process.exit(1);if("ios"===a){if(!await e.canRunCommand("pod --version"))return e.Log.error("CocoaPods is required to run the iOS example project. See installation options:"),e.Log.error("https://guides.cocoapods.org/using/getting-started.html#getting-started"),void process.exit(1);const t=o.execSync("pod --version").toString().trim();if(r.gt("1.7.0",t))return e.Log.error("CocoaPods 1.7.0 or greater is required to run the iOS example project. See upgrade options:"),e.Log.error("https://guides.cocoapods.org/using/getting-started.html#getting-started"),void process.exit(1)}const d=require.resolve("diez"),c=global.process.cwd(),g=i.resolve(c,"..","example-codebases",a),l=await e.getPackageManager();let p;e.Log.comment(`Building Diez project for target ${a}...`);const m=n[a];switch(a){case"android":l.execBinary("diez compile -t android",{stdio:"inherit"}),e.Log.comment("Starting the Diez hot server..."),p=o.fork(d,["hot","-t","android"],{stdio:"inherit"});break;case"ios":l.execBinary("diez compile -t ios --cocoapods",{stdio:"inherit"}),e.Log.comment("Installing CocoaPods dependencies in example codebase..."),o.execSync("pod install",{cwd:g,stdio:"inherit"}),e.Log.comment("Starting the Diez hot server..."),p=o.fork(d,["hot","-t","ios"],{stdio:"inherit"});break;case"web":l.execBinary("diez compile -t web",{stdio:"inherit"});const t=e.loadingMessage("Installing Node dependencies in example codebase...");await l.installAllDependencies({cwd:g}),t.stop(),e.Log.comment("Starting the Diez hot server..."),p=o.fork(d,["hot","-t","web"],{stdio:"inherit"})}let h;const u=r=>{"built"===r&&(p.removeListener("message",u),h=(()=>{switch(e.Log.comment(`\nYour Diez project is now running in hot mode for ${a}.\n\nIn hot mode, Diez observes and emits changes to your design language in real time.\n\nTo learn more, follow along with the guide at:\n\n  ${e.Format.code(m)}\n`),a){case"android":return e.isMacOS()&&e.locateBinaryMacOS("com.google.android.studio")?o.execSync(`open -b com.google.android.studio ${g}`):e.Log.comment(`Open ${g} in Android Studio to run the example project.`);case"ios":try{const r=t.readdirSync(g).find(e=>e.endsWith(".xcworkspace"));if(!r)return;const n=i.join(g,r);return e.isMacOS()&&e.locateBinaryMacOS("com.apple.dt.Xcode")?o.execSync(`open ${n}`):e.Log.comment(`Open ${n} in Xcode to run the example project.`)}catch(e){return}case"web":return o.spawn(l.binary,["start"],{cwd:g,stdio:"inherit",shell:!0})}})())};p.on("message",u),p.on("exit",()=>{e.isChildProcess(h)&&h.kill()})});
//# sourceMappingURL=/@diez/start/lib/index.action.js.map