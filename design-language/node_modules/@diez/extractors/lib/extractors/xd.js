"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const t=require("@diez/cli-core"),a=require("@diez/generation"),r=require("@diez/storage"),n=e(require("decompress")),i=require("fs-extra"),o=require("path"),s=require("../utils"),c=".xd",l=e=>{const{r:t,g:a,b:r}=e.value;return`Color.rgba(${t}, ${a}, ${r}, ${e.alpha||1})`},p=(e,t)=>{const a=t.representations[0];a&&"application/vnd.adobe.xdcolor+json"===a.type&&e.colors.push({name:t.name,initializer:l(a.content)})},d=(e,t)=>{const r=t.representations[0];if(!r||"application/vnd.adobe.xdlineargradient+json"!==r.type)return;const n=r.content.map(({stop:e,color:t})=>({position:e,colorInitializer:l(t)}));e.gradients.push({name:t.name,initializer:a.getLinearGradientInitializer(n,{x:0,y:0},{x:1,y:1})})},u=async(e,r)=>{const n=r.representations[0];if(!n||"application/vnd.adobe.characterstyle+json"!==n.type)return;const{fontFamily:i,fontStyle:o,fontSize:s,fontColor:c,postscriptName:p,charSpacing:d,lineSpacing:u}=n.content,g=await a.locateFont(i,{name:p});g?await a.registerFont(g,e.fonts):t.Log.warning(`Unable to locate system font assets for family ${i} and style ${o}.`),e.typographs.push({name:r.name,initializer:a.getTypographInitializer(e.designLanguageName,g,p,{fontSize:s,letterSpacing:d,lineHeight:u,color:l(c)})})},g=async(e,t)=>{if(t&&t.resources&&t.resources.meta&&t.resources.meta.ux&&t.resources.meta.ux.documentLibrary)for(const a of t.resources.meta.ux.documentLibrary.elements)"application/vnd.adobe.element.color+dcx"!==a.type?"application/vnd.adobe.element.gradient+dcx"!==a.type?"application/vnd.adobe.element.characterstyle+dcx"!==a.type||await u(e,a):d(e,a):p(e,a)};class m{static create(){return new this}static async canParse(e){return await i.pathExists(e)&&o.extname(e.trim())===c}async export({source:e,assets:t,code:c},l,p=s.cliReporters){if(!await m.canParse(e))throw new Error("Invalid source file");const d=a.pascalCase(o.basename(e,".xd")),u=`${d}.xd`,y=o.join(t,`${u}.contents`);p.progress(`Creating necessary folders for ${u}...`),await s.createFolders(y,[a.AssetFolder.Slice]),p.progress(`Extracting design language from ${u}...`);const f=r.getTempFileName();let h;i.ensureDirSync(f);try{const t=(await n.default(e,f,{filter:e=>e.path.includes(o.join("resources","graphics","graphicContent.agc"))}))[0].data.toString();h=JSON.parse(t)}catch(t){throw new Error(`Error while trying to open ${e}: ${t.message}`)}const x=a.createDesignLanguageSpec(d,y,o.join(c,`${u}.ts`),l);return await g(x,h),a.codegenDesignLanguage(x)}}module.exports=m;
//# sourceMappingURL=/@diez/extractors/lib/extractors/xd.js.map